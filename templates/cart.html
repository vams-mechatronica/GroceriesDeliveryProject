{% load static %}
<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <!-- title -->
        <title>Cart Page</title>
        <meta name="description" content=""/>
        <meta name="keywords" content=""/>
        <meta name="author" content="">
        <!-- favicon -->
        <link rel="shortcut icon" type="image/favicon" href="image/fevicon.png">
        <!-- bootstrap -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/bootstrap.min.css' %}">
        <!-- simple-line icon -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/simple-line-icons.css' %}">
        <!-- font-awesome icon -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/font-awesome.min.css' %}">
        <!-- themify icon -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/themify-icons.css' %}">
        <!-- ion icon -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/ionicons.min.css' %}">
        <!-- owl slider -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/owl.carousel.min.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/owl.theme.default.min.css' %}">
        <!-- swiper -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/swiper.min.css' %}">
        <!-- animation -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/animate.css' %}">
        <!-- style -->
        <link rel="stylesheet" type="text/css" href="{% static 'css/style.css' %}">
        <link rel="stylesheet" type="text/css" href="{% static 'css/responsive.css' %}">
    </head>
    <body class="home-1">
        <!-- cart header -->
        <div class="cart-header">
            <div class="container">
                <div class="row">
                    <div class="col">
                        <h1>Cart</h1>
                        <div class="change-address">
                            <ul>
                                <li><span class="save-add"><b>WORK</b></span>- <span class="current-add">{{useraddress.user_address}}</span></li>
                            </ul>
                            <a href="{% url 'auth_update_profile' %}" class="chng-add"><i class="ion-ios-location"></i> Change Address</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        <!-- End cart header -->
        <!-- cart start -->
        <section class="cart-page section-tb-padding">
            <div class="container">
                <div class="row">
                    <div class="col-xl-9 col-xs-12 col-sm-12 col-md-12 col-lg-8">
                        <div class="cart-area">
                            {% for item in object.items.all  %}
                            <div class="cart-details">
                                <div class="cart-all-pro">
                                    <div class="cart-pro">
                                        <div class="cart-pro-image">
                                            <a href="{% url 'productdetail' item.item.products.product_id %}"><img src="/media/{{item.item.products.prod_mainimage}}" class="img-fluid" alt="" width="50"></a>
                                        </div>
                                        <div class="pro-details">
                                            <a href="{% url 'productdetail' item.item.products.product_id %}">{{item.item.products.product_name}}</a>
                                            <span class="pro-size"><span class="size"></span> {{item.item.products.unit}}</span>
                                        </div>
                                    </div>
                                    <div class="qty-item">
                                        <div class="center">
                                            <div class="plus-minus">
                                                <span>
                                                    {% comment %} <a href="{% url 'removesingleitemfromcart' item.item.products.product_id %}" class="minus-btn text-black">-</a> {% endcomment %}
                                                    <a href="#" class="minus-btn text-black" id="{{item.item.products.product_id}}-minus-btn" field="{{item.item.products.product_id}}-name">-</a>
                                                    <input type="hidden" id="{{item.item.products.product_id}}-url-minus" data-url="{% url 'removesingleitemfromcart' item.item.products.product_id %}">
                                                    <input type="text" name="{{item.item.products.product_id}}-name" id="{{item.item.products.product_id}}-name-value" value="{{item.quantity}}">
                                                    {% comment %} <a href="{% url 'addtocart' item.item.products.product_id %}" class="plus-btn text-black">+</a> {% endcomment %}
                                                    <a href="#" class="plus-btn text-black" id="{{item.item.products.product_id}}-plus-btn" field="{{item.item.products.product_id}}-name">+</a>
                                                    <input type="hidden" id="{{item.item.products.product_id}}-url-plus" data-url="{% url 'addtocart' item.item.products.product_id %}">
                                                </span>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="all-pro-price">
                                        <span>₹{{item.get_amount_saved|floatformat:2}}</span>
                                        <span class="sell_price">₹{{item.get_total_item_price|floatformat:2}}</span>
                                    </div>
                                </div>
                            </div>
                            {% empty %}
                                <tr>
                                    <td colspan='5'>Your cart is empty</td>
                                </tr>
                            {% endfor %}
                        </div>
                    </div>
                    <div class="col-xl-3 col-xs-12 col-sm-12 col-md-12 col-lg-4">
                        <div class="cart-total">
                            <div class="cart-price">
                                <span><b>Summary</b></span>
                            </div>
                            <div class="cart-price">
                                <span>Product</span>
                                <div class="d-flex">
                                    <span class="sell_price">₹{{object.get_max_total|floatformat:2}}</span>
                                <span class="total color_green">₹{{object.get_total|floatformat:2}}</span>
                                </div>
                            </div>
                             <div class="cart-price">
                                <span>Delivery</span>
                                <div class="d-flex">
                                    <span class="sell_price">₹20</span>
                                <span class="total color_green">₹{{delivery}}</span>
                                </div>
                            </div>
                            
                            <div class="shop-total">
                                <span><b>Total</b></span>
                                <span class="total-amount">₹{{grandtotal|floatformat:2}}</span>
                            </div>
                            <a href="{% url 'paymentcheckout' grandtotal%}" class="check-link btn btn-style1">Continue to payment</a>
                        </div>
                    </div>
                </div>
            </div>
        </section>
        <!-- cart end -->
        <!-- jquery -->
        <script src="{% static 'js/modernizr-2.8.3.min.js' %}"></script>
        <script src="{% static 'js/jquery-3.6.0.min.js' %}"></script>
        <!-- bootstrap -->
        <script src="{% static 'js/bootstrap.min.js' %}"></script>
        <!-- popper -->
        <script src="{% static 'js/popper.min.js' %}"></script>
        <!-- fontawesome -->
        <script src="{% static 'js/fontawesome.min.js' %}"></script>
        <!-- swiper -->
        <script src="{% static 'js/swiper.min.js' %}"></script>
        <!-- custom -->
        <script src="{% static 'js/custom.js' %}"></script>
        <script>
            {% comment %} $("#plus-btn").click (function () {
            var v = parseInt($('#name-value').text(value));
            console.log(v);
            $('#name-value').html(++v);
            }); {% endcomment %}
            //if ($button.class() == "plus-btn") {
            //var newVal = parseFloat(oldValue) + 1;});
            //window.location.href = $("#Url").attr("data-url")   
            {% comment %} } else {
            // Don't allow decrementing below zero
            if (oldValue > 0) {
                var newVal = parseFloat(oldValue) - 1;
            } else {
                newVal = 0;
            }
            }
            $button.parent().find("input").val(newVal);
            }); {% endcomment %}
            {% comment %} $(function() {
                var value = parseInt($('#name-value').text(value));

                $('#minus-btn').click(function() {
                    if (value == 0) return;
                    value--;
                    $('#name-value').text(value);
                    console.log(value);
                }

                $('#plus-btn').click(function() {
                    value++;
                    $('#name-value').text(value);
                }
            }); {% endcomment %}
            jQuery(document).ready(function(){
    // This button will increment the value
    $('.plus-btn').click(function(e){
        // Stop acting like a button
        e.preventDefault();
        // Get the field name
        fieldName = $(this).attr('field');
        const elementId = $(this).attr('id').split('-')[0]
        //console.log(elementId);
        // Get its current value
        var currentVal = parseInt($('input[name='+fieldName+']').val());
        window.location.href = $("#"+elementId+"-url-plus").attr("data-url");
        // If is not undefined
        if (!isNaN(currentVal)) {
            // Increment
            $('input[name='+fieldName+']').val(currentVal + 1);
            window.location.href = $("#"+elementId+"-url-plus").attr("data-url");
        } else {
            // Otherwise put a 0 there
            $('input[name='+fieldName+']').val(0);
            window.location.href = $("#"+elementId+"-url-plus").attr("data-url");
        }
    });
    // This button will decrement the value till 0
    $(".minus-btn").click(function(e) {
        // Stop acting like a button
        e.preventDefault();
        // Get the field name
        fieldName = $(this).attr('field');
        const elementId = $(this).attr('id').split('-')[0]
        // Get its current value
        var currentVal = parseInt($('input[name='+fieldName+']').val());
        // If it isn't undefined or its greater than 0
        window.location.href = $("#"+elementId+"-url-minus").attr("data-url");
        if (!isNaN(currentVal) && currentVal > 0) {
            // Decrement one
            $('input[name='+fieldName+']').val(currentVal - 1);
            window.location.href = $("#"+elementId+"-url-minus").attr("data-url");
        } else {
            // Otherwise put a 0 there
            $('input[name='+fieldName+']').val(0);
            window.location.href = $("#"+elementId+"-url-minus").attr("data-url");
        }
    });
});

        </script>
    </body>
</html>